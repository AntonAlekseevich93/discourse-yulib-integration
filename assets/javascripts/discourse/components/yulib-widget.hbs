{{!-- Это виджет на главной привязки приложения --}}
{{#if this.yulibProfile}}
{{!-- ДОБАВИЛИ: style="cursor: pointer" и {{on "click" ...}} --}}
    <div
            class="yulib-home-widget {{if this.isCollapsedLocal 'collapsed' 'alert alert-success'}}"
            style="cursor: pointer;"
        {{on "click" this.navigateToSettings}}
            role="button"
    >
        <div class="yulib-widget-left">
            <img
                    src="{{this.yulibProfile.avatar}}"
                    style="width: 45px; height: 45px; border-radius: 50%; object-fit: cover;"
                    class="yulib-user-avatar {{if this.avatarFailed 'is-placeholder'}}"
                {{on "error" this.handleAvatarError}}
            />
            <div class="yulib-widget-info">
                {{#if this.isCollapsedLocal}}
                    <div class="yulib-widget-user collapsed-name">{{this.yulibProfile.username}}</div>
                {{else}}
                    <div class="yulib-widget-title">{{i18n "yulib_integration.connected"}}</div>
                    <div class="yulib-widget-user">{{this.yulibProfile.username}}</div>
                {{/if}}
            </div>
        </div>

        {{!-- ЦЕНТРАЛЬНАЯ ЧАСТЬ (Кнопка включения пушей) --}}
        {{#unless this.isCollapsedLocal}}
            <div class="yulib-widget-center">
                {{!-- БЕЗОПАСНОСТЬ: Проверяем currentUser перед чтением свойства --}}
                {{#if this.currentUser}}
                    {{#unless this.currentUser.yulib_push_enabled}}
                        <DButton
                                @label="yulib_integration.enablePush"
                                @action={{this.enablePush}}
                                @icon="bell"
                                class="btn-small btn-primary yulib-enable-btn"
                        />
                    {{/unless}}
                {{/if}}
            </div>
        {{/unless}}

        {{!-- ПРАВАЯ ЧАСТЬ (Иконки статуса и Сворачивание) --}}
        <div class="yulib-widget-right">
            {{!-- БЕЗОПАСНОСТЬ: Оборачиваем логику в проверку пользователя --}}
            {{#if this.currentUser}}
                {{#if this.currentUser.yulib_push_enabled}}
                {{!-- Если пуши включены --}}
                    {{#unless this.isCollapsedLocal}}
                        {{d-icon "bell" style="color: green;"}}
                    {{/unless}}

                    {{!-- Кнопка сворачивания доступна, когда пуши работают --}}
                    <DButton
                            @action={{this.toggleBanner}}
                            @icon={{if this.isCollapsedLocal "angle-down" "angle-up"}}
                            class="btn-flat yulib-toggle-btn"
                            @title={{if this.isCollapsedLocal "Развернуть" "Свернуть"}}
                    />
                {{else}}
                {{!-- Если пуши выключены --}}
                    <div class="has-tooltip" title="Не удалось подключить уведомления">
                        {{d-icon "bell-slash" style="color: var(--primary-medium);"}}
                    </div>

                    {{!-- СОВЕТ: Я добавил кнопку сворачивания СЮДА ТОЖЕ.
                          Раньше, если пуши не работали, пользователь НЕ МОГ свернуть баннер.
                          Теперь сможет. --}}
                    <DButton
                            @action={{this.toggleBanner}}
                            @icon={{if this.isCollapsedLocal "angle-down" "angle-up"}}
                            class="btn-flat yulib-toggle-btn"
                            @title={{if this.isCollapsedLocal "Развернуть" "Свернуть"}}
                    />
                {{/if}}
            {{/if}}
        </div>
    </div>
{{else}}
{{!-- БЛОК ДЛЯ ГОСТЕЙ ИЛИ НЕПРИВЯЗАННЫХ (Promo Widget) --}}
{{!-- settingsUrl внутри JS уже безопасен --}}
    <a href="{{this.settingsUrl}}" class="yulib-home-widget yulib-promo-widget">
        <div class="yulib-widget-left">
            <div class="promo-icon-wrapper">
                {{d-icon "link"}}
            </div>
            <div class="yulib-widget-info">
                <div class="yulib-widget-title">Привяжите приложение к форуму</div>
                <div class="yulib-widget-user">Получайте уведомления и многое другое</div>
            </div>
        </div>
        <div class="yulib-widget-right">
            <div class="has-tooltip" title="Не удалось подключить уведомления">
                {{d-icon "bell-slash" class="icon-disabled"}}
            </div>
        </div>
    </a>
{{/if}}